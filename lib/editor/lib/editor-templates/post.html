 <div id="post" class="post">
  <div ng-show='post.mode == "preview"' class='view preview' ng-include='post.previewUrl'>
  </div>
  <div ng-hide='post.mode == "preview"' class='page-content-wrap inner editor views markdown clearfix'>
    <span ng-switch='post.mode' >
      <div ng-switch-when='save' class='view diff page-inner'>
        <div class='page-info'>
          <h1 class='title'> Review your changes:</h1>
          <p>Additions are highlighted in green. Deletions are crossed out.</p>
        </div>
        <div class='diff-content inner' ng-bind-html-unsafe='post.html'></div>
      </div>

      <div ng-switch-when='edit' class='view active edit page-inner-edit'>
        <form class='clearfix'>
          <input id='title' ng-model='post.data.metadata.title' placeholder='Title...' ng-change='post.makeDirty()'/>
          <div class='blurb-wrap'>
            <input id='blurb' ng-model='post.data.metadata.blurb' placeholder='Summary...' maxlength='140' ng-change='post.makeDirty()'/>
            <div class='char-count'>{{post.data.metadata.blurb.length || 0}}/140</div>
          </div>
        </form>
        <div ng-include='post.bodyTemplate'></div>

      </div>
    </span>
    <div class='page-sidebar'>
      <span ng-switch='post.mode'>
        <div ng-switch-when='edit' class='upload-image' style='background-image: url({{post.data.metadata.image}})' ng-controller="uploadCtrl" onend='post.data.metadata.image = path; post.makeDirty();'>
          <input class="fileUpload" type="file" name="files[]" multiple>
        </div>
        <div ng-switch-when='save' style='background-image: url({{post.data.metadata.image}})' class='page-image'></div>
      </span>
      <div editor-menu></div>
      <span ng-show='post.showAttachments()'>
        <div class='upload-attachment' ng-controller="uploadCtrl" onend='post.addAttachment(path, name); post.makeDirty()'>
          <input class="fileUpload" type="file" name="files[]" multiple>
        </div>
        <ul class='attachments'>
          <li ng-repeat='attachment in post.data.metadata.attachments'>
            <a ng-href='{{attachment.path}}' download='{{attachment.name}}' target="_self">{{attachment.name}}
              <span ng-click='$event.preventDefault(); post.removeAttachment($index)'>&times;</span>
            </a>
          </li>
        </ul>
      </span>
    </div>
    <div id='code' ng-show='post.mode == "edit" && post.data.metadata.type != "unit"' ></div>
  </div>
  <canvas id='post-blurred-image' class='stretch' blur='{{post.data.metadata.image}}'></canvas>
</div>


